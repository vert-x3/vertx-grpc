= Vert.x gRPC

== gRPC Server

[source,java]
----
GreeterGrpc.GreeterImplBase service = new GreeterGrpc.GreeterImplBase() {
  @Override
  public void sayHello(HelloRequest request, StreamObserver<HelloReply> responseObserver) {
    responseObserver.onNext(HelloReply.newBuilder().setMessage(request.getName()).build());
    responseObserver.onCompleted();
  }
};

// Create the server
VertxServer rpcServer = VertxServerBuilder
    .forAddress(vertx, "my.host", 8080)
    .addService(service)
    .build();

// Start is asynchronous
rpcServer.start();
----

SSL configuration

[source,java]
----
VertxServerBuilder builder = VertxServerBuilder.forPort(vertx, 8080)
    .useSsl(options -> options
        .setSsl(true)
        .setUseAlpn(true)
        .setKeyStoreOptions(new JksOptions()
            .setPath("server-keystore.jks")
            .setPassword("secret")));
----

== gRPC Client

[source,java]
----
ManagedChannel channel = VertxChannelBuilder
    .forAddress(vertx, "localhost", 8080)
    .usePlaintext(true)
    .build();

// Get a stub to use for interacting with the remote service
GreeterGrpc.GreeterStub stub = GreeterGrpc.newStub(channel);

// Make a request
HelloRequest request = HelloRequest.newBuilder().setName("Julien").build();

// Call the remote service
stub.sayHello(request, StreamHelper.future(ar -> {
  if (ar.succeeded()) {
    System.out.println("Got the server response: " + ar.result().getMessage());
  } else {
    System.out.println("Coult not reach server " + ar.cause().getMessage());
  }
}));
----

SSL configuration

[source,java]
----
ManagedChannel channel = VertxChannelBuilder.
    forAddress(vertx, "localhost", 8080)
    .useSsl(options -> options
        .setSsl(true)
        .setUseAlpn(true)
        .setTrustStoreOptions(new JksOptions()
            .setPath("client-truststore.jks")
            .setPassword("secret")))
    .build();
----